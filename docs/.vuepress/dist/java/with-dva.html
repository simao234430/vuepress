<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Use umi with dva | 肖总教java</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/assets/css/0.styles.ebcf3451.css" as="style"><link rel="preload" href="/assets/js/app.f5cc174e.js" as="script"><link rel="preload" href="/assets/js/23.24f97e00.js" as="script"><link rel="prefetch" href="/assets/js/10.bf39ec18.js"><link rel="prefetch" href="/assets/js/11.210e0db4.js"><link rel="prefetch" href="/assets/js/12.ffb3dc49.js"><link rel="prefetch" href="/assets/js/13.7299ff02.js"><link rel="prefetch" href="/assets/js/14.1e018a41.js"><link rel="prefetch" href="/assets/js/15.c7d46dc9.js"><link rel="prefetch" href="/assets/js/16.aa71f129.js"><link rel="prefetch" href="/assets/js/17.ee9ad401.js"><link rel="prefetch" href="/assets/js/18.bc02023f.js"><link rel="prefetch" href="/assets/js/19.ac6195b2.js"><link rel="prefetch" href="/assets/js/2.0f4038f2.js"><link rel="prefetch" href="/assets/js/20.000b2e2e.js"><link rel="prefetch" href="/assets/js/21.cda796ee.js"><link rel="prefetch" href="/assets/js/22.b96309d1.js"><link rel="prefetch" href="/assets/js/24.897297e4.js"><link rel="prefetch" href="/assets/js/3.52b528e1.js"><link rel="prefetch" href="/assets/js/4.c1e06c01.js"><link rel="prefetch" href="/assets/js/5.c4dd6f34.js"><link rel="prefetch" href="/assets/js/6.1701df0e.js"><link rel="prefetch" href="/assets/js/7.e872f69f.js"><link rel="prefetch" href="/assets/js/8.b5f42330.js"><link rel="prefetch" href="/assets/js/9.444abcb4.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ebcf3451.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">肖总教java</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/java/" class="nav-link router-link-active">java</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/java/" class="nav-link router-link-active">java</a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading"><span>java</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/java/" class="sidebar-link">Introduction</a></li><li><a href="/java/java_intro.html" class="sidebar-link">java入门</a></li><li><a href="/java/getting-started.html" class="sidebar-link">Getting Started</a></li><li><a href="/java/create-umi-app.html" class="sidebar-link">Create a Project With create-umi</a></li><li><a href="/java/examples.html" class="sidebar-link">Examples</a></li><li><a href="/java/app-structure.html" class="sidebar-link">Directory and Convention</a></li><li><a href="/java/router.html" class="sidebar-link">Router</a></li><li><a href="/java/navigate-between-pages.html" class="sidebar-link">Navigate between pages</a></li><li><a href="/java/config.html" class="sidebar-link">Configuration</a></li><li><a href="/java/html-template.html" class="sidebar-link">HTML Template</a></li><li><a href="/java/test.html" class="sidebar-link">Introduction</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading open"><span>Advanced</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/java/mock-data.html" class="sidebar-link">Mock Data</a></li><li><a href="/java/with-dva.html" class="active sidebar-link">Use umi with dva</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/java/with-dva.html#features" class="sidebar-link">Features</a></li><li class="sidebar-sub-header"><a href="/java/with-dva.html#usage" class="sidebar-link">Usage</a></li><li class="sidebar-sub-header"><a href="/java/with-dva.html#registering-models" class="sidebar-link">Registering models</a></li><li class="sidebar-sub-header"><a href="/java/with-dva.html#configuration-and-plugins" class="sidebar-link">Configuration and plugins</a></li><li class="sidebar-sub-header"><a href="/java/with-dva.html#faq" class="sidebar-link">FAQ</a></li><li class="sidebar-sub-header"><a href="/java/with-dva.html#references" class="sidebar-link">References</a></li></ul></li><li><a href="/java/load-on-demand.html" class="sidebar-link">Load on demand</a></li><li><a href="/java/runtime-config.html" class="sidebar-link">Runtime Config</a></li><li><a href="/java/block.html" class="sidebar-link">Block</a></li><li><a href="/java/deploy.html" class="sidebar-link">Deploy</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Reference</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/java/faq.html" class="sidebar-link">FAQ</a></li><li><a href="/java/migration.html" class="sidebar-link">Migrate from umi 1.x</a></li><li><a href="/java/env-variables.html" class="sidebar-link">.env and Environment Variables</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="use-umi-with-dva"><a href="#use-umi-with-dva" aria-hidden="true" class="header-anchor">#</a> Use umi with dva</h1> <p>As of <code>&gt;= umi@2</code>, we recommend using <a href="https://github.com/umijs/umi/tree/master/packages/umi-plugin-react" target="_blank" rel="noopener noreferrer">umi-plugin-react<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> for <code>dva</code> integration.</p> <h2 id="features"><a href="#features" aria-hidden="true" class="header-anchor">#</a> Features</h2> <ul><li><strong>Model loading by directory</strong>, getting rid of <code>app.model</code></li> <li><strong>File name as namespace</strong>, <code>namespace</code> as model key will be exported by <code>umi</code></li> <li><strong>No manually defined router.js</strong>, <code>umi</code> will take over the router stuff, and both <code>model</code>s and <code>component</code>s can be loaded on demand</li> <li><strong>Built-in query-string handler</strong>, manually encoding and decoding URL are not required any more</li> <li><strong>Built-in dva-loading and dva-immer support</strong>, of which <code>dva-immer</code> can be enabled via configuration</li> <li><strong>Out of box</strong>, dependencies such as: <code>dva</code>, <code>dva-loading</code>, <code>dva-immer</code>, <code>path-to-regexp</code>, <code>object-assign</code>, <code>react</code>, <code>react-dom</code> are built in, so that you don't have to worry about them</li></ul> <h2 id="usage"><a href="#usage" aria-hidden="true" class="header-anchor">#</a> Usage</h2> <p>Install via <code>yarn</code>,</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ yarn add umi-plugin-react
</code></pre></div><p>Install via <code>npm</code>, using the command <code>npm install --save umi-plugin-react</code>.</p> <p>Add configuration in <code>.umirc.js</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span>
      <span class="token string">'umi-plugin-react'</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        dva<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">.</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Enable <code>dva-immer</code> for elegant reducer writing experience</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span>
      <span class="token string">'umi-plugin-react'</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        dva<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          immer<span class="token punctuation">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="registering-models"><a href="#registering-models" aria-hidden="true" class="header-anchor">#</a> Registering models</h2> <p>There are two types of models: the globally registered (global) model, and the page-level model.</p> <p>The global model should be defined in <code>/src/models/</code>, and can be referenced in all other pages.</p> <p>The page-level model should not be used in any other page.</p> <p>Model loading rules:</p> <ul><li><code>src/models/**/*.js</code> are defined as global models</li> <li><code>src/pages/**/models/**/*.js</code> are defined as page-level models</li> <li>global models will be loaded along with the application; page-level models are loaded on demand while in <code>production</code> build (both will always be loaded in <code>development</code> build)</li> <li>page-level models can be <code>.js</code> files in <code>models/**/*.js</code> pattern</li> <li>page-level models can be scanned upward to app structure, For example: if you have page <code>.js</code> like <code>pages/a/b.js</code>, its page-level model shall be <code>pages/a/b/models/**/*.js</code> + <code>pages/a/models/**/*.js</code>...</li> <li>if <code>model.js</code> is defined, the page should be a single-file-model, which means you don't have to create <code>models</code> directory if you have only one model. So if you have <code>model.js</code> defined, all <code>.js</code> files defined in <code>models/**/*.js</code> will be ignored</li></ul> <p>Example:</p> <div class="language- extra-class"><pre class="language-text"><code>+ src
  + models
    - g.js
  + pages
    + a
      + models
        - a.js
        - b.js
        + ss
          - s.js
      - page.js
    + c
      - model.js
      + d
        + models
          - d.js
        - page.js
      - page.js
</code></pre></div><p>With the above file structure:</p> <ul><li>the global model is <code>src/models/g.js</code></li> <li>the page-level models for <code>/a</code> is <code>src/pages/a/models/{a,b,ss/s}.js</code></li> <li>the page-level model for <code>/c</code> is <code>src/pages/c/model.js</code></li> <li>the page-level models for <code>/c/d</code> are <code>src/pages/c/model.js, src/pages/c/d/models/d.js</code></li></ul> <h2 id="configuration-and-plugins"><a href="#configuration-and-plugins" aria-hidden="true" class="header-anchor">#</a> Configuration and plugins</h2> <blockquote><p>The previous configuration in <code>src/dva.js</code> has been deprecated, and will remove support in next major release.</p></blockquote> <p>Create a new <code>app.js</code> in the <code>src</code> directory with the following contents:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">const</span> dva <span class="token operator">=</span> <span class="token punctuation">{</span>
  config<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token function">onError</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'dva-logger'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="faq"><a href="#faq" aria-hidden="true" class="header-anchor">#</a> FAQ</h2> <h3 id="page-component-is-not-re-rendered-whenever-url-changed"><a href="#page-component-is-not-re-rendered-whenever-url-changed" aria-hidden="true" class="header-anchor">#</a> Page component is not re-rendered whenever url changed?</h3> <p>If you have <code>connect</code> data in <code>layouts/index.js</code>, <code>umi/withRouter</code> is required</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> withRouter <span class="token keyword">from</span> <span class="token string">'umi/withRouter'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">withRouter</span><span class="token punctuation">(</span><span class="token function">connect</span><span class="token punctuation">(</span>mapStateToProps<span class="token punctuation">)</span><span class="token punctuation">(</span>LayoutComponent<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="how-to-access-store-or-dispatch"><a href="#how-to-access-store-or-dispatch" aria-hidden="true" class="header-anchor">#</a> How to access <code>store</code> or <code>dispatch</code>?</h3> <div class="language-js extra-class"><pre class="language-js"><code>window<span class="token punctuation">.</span>g_app<span class="token punctuation">.</span>_store
window<span class="token punctuation">.</span>g_app<span class="token punctuation">.</span>_store<span class="token punctuation">.</span>dispatch
</code></pre></div><h3 id="how-to-disable-load-on-demand-for-component-and-models"><a href="#how-to-disable-load-on-demand-for-component-and-models" aria-hidden="true" class="header-anchor">#</a> How to disable load on demand for <code>component</code> and <code>models</code>?</h3> <p>Add config to <code>.umirc.js</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span>
      <span class="token string">'umi-plugin-react'</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        dva<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          dynamicImport<span class="token punctuation">:</span> undefined <span class="token comment">// config in dva</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        dynamicImport<span class="token punctuation">:</span> undefined   <span class="token comment">// root config will be inherited as well</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="page-component-is-not-re-rendered-whenever-url-is-changed-while-connect-data-in-layout"><a href="#page-component-is-not-re-rendered-whenever-url-is-changed-while-connect-data-in-layout" aria-hidden="true" class="header-anchor">#</a> Page component is not re-rendered whenever url is changed while <code>connect</code> data in <code>layout</code></h3> <p>Check the order of <code>connect</code>, <code>withRouter</code> usage</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> withRouter <span class="token keyword">from</span> <span class="token string">'umi/withRouter'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">withRouter</span><span class="token punctuation">(</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>Layout<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="references"><a href="#references" aria-hidden="true" class="header-anchor">#</a> References</h2> <ul><li><a href="https://github.com/sorrycc/blog/issues/66" target="_blank" rel="noopener noreferrer">Improve dva project with umi<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/sorrycc/blog/issues/62" target="_blank" rel="noopener noreferrer">umi + dva, write your own user-management CURD app<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/java/mock-data.html" class="prev">
          Mock Data
        </a></span> <span class="next"><a href="/java/load-on-demand.html">
          Load on demand
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.f5cc174e.js" defer></script><script src="/assets/js/23.24f97e00.js" defer></script>
  </body>
</html>
