{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{186:function(t,a,s){\"use strict\";s.r(a);var n=s(0),e=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var t=this,a=t.$createElement,s=t._self._c||a;return s(\"div\",{staticClass:\"content\"},[s(\"h1\",{attrs:{id:\"runtime-config\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#runtime-config\",\"aria-hidden\":\"true\"}},[t._v(\"#\")]),t._v(\" Runtime Config\")]),t._v(\" \"),s(\"div\",{staticClass:\"warning custom-block\"},[s(\"p\",{staticClass:\"custom-block-title\"},[t._v(\"WARNING\")]),t._v(\" \"),s(\"p\",[t._v(\"This article has not been translated yet. Wan't to help us out? Click the \"),s(\"code\",[t._v(\"Edit this page on GitHub\")]),t._v(\" at the end of the page.\")])]),t._v(\" \"),s(\"h2\",{attrs:{id:\"为什么有运行时配置？\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#为什么有运行时配置？\",\"aria-hidden\":\"true\"}},[t._v(\"#\")]),t._v(\" 为什么有运行时配置？\")]),t._v(\" \"),s(\"p\",[t._v(\"我们通过 \"),s(\"code\",[t._v(\".umirc.js\")]),t._v(\" 做编译时的配置，这能覆盖大量场景，但有一些却是编译时很难触及的。\")]),t._v(\" \"),s(\"p\",[t._v(\"比如：\")]),t._v(\" \"),s(\"ul\",[s(\"li\",[t._v(\"在出错时显示个 message 提示用户\")]),t._v(\" \"),s(\"li\",[t._v(\"在加载和路由切换时显示个 loading\")]),t._v(\" \"),s(\"li\",[t._v(\"页面载入完成时请求后端，根据响应动态修改路由\")])]),t._v(\" \"),s(\"p\",[t._v(\"这些在编译时就很难处理，或者不能处理了。\")]),t._v(\" \"),s(\"h2\",{attrs:{id:\"配置方式\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#配置方式\",\"aria-hidden\":\"true\"}},[t._v(\"#\")]),t._v(\" 配置方式\")]),t._v(\" \"),s(\"p\",[t._v(\"umi 约定 \"),s(\"code\",[t._v(\"src\")]),t._v(\" 目录下的 \"),s(\"code\",[t._v(\"app.js\")]),t._v(\" 为运行时的配置文件。\")]),t._v(\" \"),s(\"div\",{staticClass:\"language-bash extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[s(\"code\",[t._v(\"+ src\\n  - app.js      \"),s(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"# 运行时配置文件\")]),t._v(\"\\n- package.json\\n\")])])]),s(\"h2\",{attrs:{id:\"配置列表\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#配置列表\",\"aria-hidden\":\"true\"}},[t._v(\"#\")]),t._v(\" 配置列表\")]),t._v(\" \"),s(\"h3\",{attrs:{id:\"patchroutes\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#patchroutes\",\"aria-hidden\":\"true\"}},[t._v(\"#\")]),t._v(\" patchRoutes\")]),t._v(\" \"),s(\"p\",[t._v(\"用于运行时修改路由。\")]),t._v(\" \"),s(\"p\",[t._v(\"参数：\")]),t._v(\" \"),s(\"ul\",[s(\"li\",[t._v(\"routes: \"),s(\"code\",[t._v(\"Array\")]),t._v(\"，路由配置\")])]),t._v(\" \"),s(\"p\",[t._v(\"e.g. 添加一个 \"),s(\"code\",[t._v(\"/foo\")]),t._v(\" 的路由，\")]),t._v(\" \"),s(\"div\",{staticClass:\"language-js extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-js\"}},[s(\"code\",[s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"export\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"function\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"patchRoutes\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),t._v(\"routes\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n  routes\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"[\")]),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"0\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"]\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"unshift\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n    path\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'/foo'\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\"\\n    component\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"require\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'./routes/foo'\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"default\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\"\\n  \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\"\\n\")])])]),s(\"p\",[t._v(\"可能的场景：\")]),t._v(\" \"),s(\"ul\",[s(\"li\",[t._v(\"和 \"),s(\"code\",[t._v(\"render\")]),t._v(\" 配合使用，请求服务端根据响应动态更新路由\")]),t._v(\" \"),s(\"li\",[t._v(\"修改全部路由，加上某个前缀\")]),t._v(\" \"),s(\"li\",[t._v(\"...\")])]),t._v(\" \"),s(\"p\",[t._v(\"注：\")]),t._v(\" \"),s(\"ol\",[s(\"li\",[t._v(\"同样适用约定式路由\")]),t._v(\" \"),s(\"li\",[t._v(\"直接修改 \"),s(\"code\",[t._v(\"routes\")]),t._v(\" 就好，不要返回新的路由对象\")])]),t._v(\" \"),s(\"h3\",{attrs:{id:\"render\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#render\",\"aria-hidden\":\"true\"}},[t._v(\"#\")]),t._v(\" render\")]),t._v(\" \"),s(\"p\",[t._v(\"用于改写把整个应用 render 到 dom 数里的方法。\")]),t._v(\" \"),s(\"p\",[t._v(\"参数：\")]),t._v(\" \"),s(\"ul\",[s(\"li\",[t._v(\"oldRender， \"),s(\"code\",[t._v(\"Function\")]),t._v(\"，原始 render 方法，需至少被调用一次\")])]),t._v(\" \"),s(\"p\",[t._v(\"e.g. 延迟 1s 渲染应用，\")]),t._v(\" \"),s(\"div\",{staticClass:\"language-js extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-js\"}},[s(\"code\",[s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"export\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"function\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"render\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),t._v(\"oldRender\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n  \"),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"setTimeout\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),t._v(\"oldRender\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"1000\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\"\\n\")])])]),s(\"p\",[t._v(\"可能的场景：\")]),t._v(\" \"),s(\"ol\",[s(\"li\",[t._v(\"渲染应用之前做权限校验，不通过则跳转到登录页\")])]),t._v(\" \"),s(\"h3\",{attrs:{id:\"onroutechange\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#onroutechange\",\"aria-hidden\":\"true\"}},[t._v(\"#\")]),t._v(\" onRouteChange\")]),t._v(\" \"),s(\"p\",[t._v(\"用于在初始加载和路由切换时做一些事情。\")]),t._v(\" \"),s(\"p\",[t._v(\"参数：\")]),t._v(\" \"),s(\"ul\",[s(\"li\",[t._v(\"Object\\n\"),s(\"ul\",[s(\"li\",[t._v(\"location：\"),s(\"code\",[t._v(\"Object\")]),t._v(\", history 提供的 location 对象\")]),t._v(\" \"),s(\"li\",[t._v(\"routes: \"),s(\"code\",[t._v(\"Array\")]),t._v(\", 路由配置\")]),t._v(\" \"),s(\"li\",[t._v(\"action: \"),s(\"code\",[t._v(\"PUSH|POP|REPLACE|undefined\")]),t._v(\"，初次加载时为 \"),s(\"code\",[t._v(\"undefined\")])])])])]),t._v(\" \"),s(\"p\",[t._v(\"e.g.\")]),t._v(\" \"),s(\"div\",{staticClass:\"language-js extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-js\"}},[s(\"code\",[s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"export\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"function\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"onRouteChange\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\" location\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\" routes\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\" action \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n  \"),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"bacon\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),t._v(\"location\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),t._v(\"pathname\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\"\\n\")])])]),s(\"p\",[t._v(\"可能的场景：\")]),t._v(\" \"),s(\"ol\",[s(\"li\",[t._v(\"埋点统计\")])]),t._v(\" \"),s(\"p\",[t._v(\"注：\")]),t._v(\" \"),s(\"ol\",[s(\"li\",[t._v(\"初次加载时也会执行，但 action 为 \"),s(\"code\",[t._v(\"undefined\")])])]),t._v(\" \"),s(\"h3\",{attrs:{id:\"rootcontainer\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#rootcontainer\",\"aria-hidden\":\"true\"}},[t._v(\"#\")]),t._v(\" rootContainer\")]),t._v(\" \"),s(\"p\",[t._v(\"用于封装 root container，可以取一部分，或者外面套一层，等等。\")]),t._v(\" \"),s(\"p\",[t._v(\"参数：\")]),t._v(\" \"),s(\"ul\",[s(\"li\",[t._v(\"container，\"),s(\"code\",[t._v(\"ReactComponent\")]),t._v(\"，React 应用最上层的根组件\")])]),t._v(\" \"),s(\"p\",[t._v(\"e.g.\")]),t._v(\" \"),s(\"div\",{staticClass:\"language-javascript extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-javascript\"}},[s(\"code\",[s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"export\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"function\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"rootContainer\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),t._v(\"container\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n  \"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"const\")]),t._v(\" DvaContainer \"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"require\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'@tmp/DvaContainer'\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"default\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n  \"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"return\")]),t._v(\" React\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"createElement\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),t._v(\"DvaContainer\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"null\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\" container\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\"\\n\")])])]),s(\"p\",[t._v(\"可能的场景：\")]),t._v(\" \"),s(\"ol\",[s(\"li\",[t._v(\"dva、intl 等需要在外层有个 Provider 的场景\")])]),t._v(\" \"),s(\"h3\",{attrs:{id:\"modifyrouteprops\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#modifyrouteprops\",\"aria-hidden\":\"true\"}},[t._v(\"#\")]),t._v(\" modifyRouteProps\")]),t._v(\" \"),s(\"p\",[t._v(\"修改传给路由组件的 props。\")]),t._v(\" \"),s(\"p\",[t._v(\"参数：\")]),t._v(\" \"),s(\"ul\",[s(\"li\",[s(\"p\",[t._v(\"props，\"),s(\"code\",[t._v(\"Object\")]),t._v(\"，原始 props\")])]),t._v(\" \"),s(\"li\",[s(\"p\",[t._v(\"Object\")]),t._v(\" \"),s(\"ul\",[s(\"li\",[t._v(\"route，\"),s(\"code\",[t._v(\"Object\")]),t._v(\"，当前路由配置\")])])])]),t._v(\" \"),s(\"p\",[t._v(\"e.g.\")]),t._v(\" \"),s(\"div\",{staticClass:\"language-js extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-js\"}},[s(\"code\",[s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"export\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"function\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"modifyRouteProps\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),t._v(\"props\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\" route \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n  \"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"return\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"...\")]),t._v(\"props\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\" foo\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'bar'\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\"\\n\")])])]),s(\"p\",[t._v(\"注：\")]),t._v(\" \"),s(\"ol\",[s(\"li\",[t._v(\"需返回新的 props\")])])])}],!1,null,null,null);a.default=e.exports}}]);","extractedComments":[]}